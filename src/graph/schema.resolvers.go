package graph

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.78

import (
	"api/domain/entities"
	"api/graph/generated"
	"api/graph/model"
	"context"
	"fmt"
)

// CreateTower is the resolver for the createTower field.
func (r *mutationResolver) CreateTower(ctx context.Context, input model.CreateTowerInput) (*entities.Tower, error) {
	tower := &entities.Tower{
		Name:        input.Name,
		Description: input.Description,
	}

	err := r.TowerRepo.Create(ctx, tower)
	if err != nil {
		return nil, err
	}

	return tower, nil
}

// UpdateTower is the resolver for the updateTower field.
func (r *mutationResolver) UpdateTower(ctx context.Context, input model.UpdateTowerInput) (*entities.Tower, error) {
	tower, err := r.TowerRepo.GetByID(ctx, input.ID)
	if err != nil {
		return nil, err
	}

	if input.Name != nil {
		tower.Name = *input.Name
	}
	if input.Description != nil {
		tower.Description = input.Description
	}

	err = r.TowerRepo.Update(ctx, tower)
	if err != nil {
		return nil, err
	}

	return tower, nil
}

// DeleteTower is the resolver for the deleteTower field.
func (r *mutationResolver) DeleteTower(ctx context.Context, id string) (bool, error) {
	err := r.TowerRepo.Delete(ctx, id)
	if err != nil {
		return false, err
	}
	return true, nil
}

// CreateFloor is the resolver for the createFloor field.
func (r *mutationResolver) CreateFloor(ctx context.Context, input model.CreateFloorInput) (*entities.Floor, error) {
	floor := &entities.Floor{
		TowerID: input.TowerID,
		Number: input.Number,
	}
	
	err := r.FloorRepo.Create(ctx, floor)
	if err != nil {
		return nil, err
	}
	
	return floor, nil
}

// UpdateFloor is the resolver for the updateFloor field.
func (r *mutationResolver) UpdateFloor(ctx context.Context, input model.UpdateFloorInput) (*entities.Floor, error) {
	floor, err := r.FloorRepo.GetByID(ctx, input.ID)
	if err != nil {
		return nil, err
	}
	
	if input.Number != nil {
		floor.Number = *input.Number
	}
	
	err = r.FloorRepo.Update(ctx, floor)
	if err != nil {
		return nil, err
	}
	
	return floor, nil
}

// DeleteFloor is the resolver for the deleteFloor field.
func (r *mutationResolver) DeleteFloor(ctx context.Context, id string) (bool, error) {
	err := r.FloorRepo.Delete(ctx, id)
	if err != nil {
		return false, err
	}
	return true, nil
}

// CreateApartment is the resolver for the createApartment field.
func (r *mutationResolver) CreateApartment(ctx context.Context, input model.CreateApartmentInput) (*entities.Apartment, error) {
	apartment := &entities.Apartment{
		FloorID:   input.FloorID,
		Number:    input.Number,
		Bedrooms:  input.Bedrooms,
		Area:      input.Area,
		Price:     input.Price,
		Available: input.Available,
	}

	err := r.ApartmentRepo.Create(ctx, apartment)
	if err != nil {
		return nil, err
	}

	return apartment, nil
}

// UpdateApartment is the resolver for the updateApartment field.
func (r *mutationResolver) UpdateApartment(ctx context.Context, input model.UpdateApartmentInput) (*entities.Apartment, error) {
	apartment, err := r.ApartmentRepo.GetByID(ctx, input.ID)
	if err != nil {
		return nil, err
	}
	
	if input.Number != nil {
		apartment.Number = *input.Number
	}
	if input.Bedrooms != nil {
		apartment.Bedrooms = input.Bedrooms
	}
	if input.Area != nil {
		apartment.Area = input.Area
	}
	if input.Price != nil {
		apartment.Price = input.Price
	}
	if input.Available != nil {
		apartment.Available = *input.Available
	}
	
	err = r.ApartmentRepo.Update(ctx, apartment)
	if err != nil {
		return nil, err
	}
	
	return apartment, nil
}

// DeleteApartment is the resolver for the deleteApartment field.
func (r *mutationResolver) DeleteApartment(ctx context.Context, id string) (bool, error) {
	err := r.ApartmentRepo.Delete(ctx, id)
	if err != nil {
		return false, err
	}
	return true, nil
}

// AddApartmentImage is the resolver for the addApartmentImage field.
func (r *mutationResolver) AddApartmentImage(ctx context.Context, apartmentID string, imageURL string, description *string) (*entities.ApartmentImage, error) {
	image := &entities.ApartmentImage{
		ApartmentID: apartmentID,
		ImageURL: imageURL,
		Description: description,
		Order: 0,
	}
	return image, nil
}

// RemoveApartmentImage is the resolver for the removeApartmentImage field.
func (r *mutationResolver) RemoveApartmentImage(ctx context.Context, imageID string) (bool, error) {
	return true, nil
}

// ReorderApartmentImages is the resolver for the reorderApartmentImages field.
func (r *mutationResolver) ReorderApartmentImages(ctx context.Context, apartmentID string, imageIds []string) (bool, error) {
	return true, nil
}

// CreateGalleryImage is the resolver for the createGalleryImage field.
func (r *mutationResolver) CreateGalleryImage(ctx context.Context, imageURL string, route string, description *string) (*entities.GalleryImage, error) {
	return &entities.GalleryImage{
		ImageURL: imageURL,
		Route: route,
		Description: description,
	}, nil
}

// UpdateGalleryImage is the resolver for the updateGalleryImage field.
func (r *mutationResolver) UpdateGalleryImage(ctx context.Context, id string, description *string) (*entities.GalleryImage, error) {
	return &entities.GalleryImage{ID: id, Description: description}, nil
}

// DeleteGalleryImage is the resolver for the deleteGalleryImage field.
func (r *mutationResolver) DeleteGalleryImage(ctx context.Context, id string) (bool, error) {
	return true, nil
}

// ReorderGalleryImages is the resolver for the reorderGalleryImages field.
func (r *mutationResolver) ReorderGalleryImages(ctx context.Context, route string, imageIds []string) (bool, error) {
	return true, nil
}

// CreateImagePin is the resolver for the createImagePin field.
func (r *mutationResolver) CreateImagePin(ctx context.Context, galleryImageID string, x float64, y float64, apartmentID string, description *string) (*entities.ImagePin, error) {
	return &entities.ImagePin{GalleryImageID: galleryImageID}, nil
}

// UpdateImagePin is the resolver for the updateImagePin field.
func (r *mutationResolver) UpdateImagePin(ctx context.Context, input model.UpdateImagePinInput) (*entities.ImagePin, error) {
	return &entities.ImagePin{}, nil
}

// DeleteImagePin is the resolver for the deleteImagePin field.
func (r *mutationResolver) DeleteImagePin(ctx context.Context, id string) (bool, error) {
	return true, nil
}

// UpdateAppConfig is the resolver for the updateAppConfig field.
func (r *mutationResolver) UpdateAppConfig(ctx context.Context, siteName *string, contactEmail *string, maintenanceMode *bool) (*entities.AppConfig, error) {
	return &entities.AppConfig{}, nil
}

// Towers is the resolver for the towers field.
func (r *queryResolver) Towers(ctx context.Context) ([]*entities.Tower, error) {
	return r.TowerRepo.GetAll(ctx)
}

// Tower is the resolver for the tower field.
func (r *queryResolver) Tower(ctx context.Context, id string) (*entities.Tower, error) {
	return r.TowerRepo.GetByID(ctx, id)
}

// Floors is the resolver for the floors field.
func (r *queryResolver) Floors(ctx context.Context, towerID *string) ([]*entities.Floor, error) {
	if towerID != nil {
		return r.FloorRepo.GetByTowerID(ctx, *towerID)
	}
	return []*entities.Floor{}, nil
}

// Floor is the resolver for the floor field.
func (r *queryResolver) Floor(ctx context.Context, id string) (*entities.Floor, error) {
	return r.FloorRepo.GetByID(ctx, id)
}

// Apartments is the resolver for the apartments field.
func (r *queryResolver) Apartments(ctx context.Context, floorID *string) ([]*entities.Apartment, error) {
	if floorID != nil {
		return r.ApartmentRepo.GetByFloorID(ctx, *floorID)
	}
	// Get all available apartments as default
	return r.ApartmentRepo.GetByStatus(ctx, entities.ApartmentStatusAvailable)
}

// Apartment is the resolver for the apartment field.
func (r *queryResolver) Apartment(ctx context.Context, id string) (*entities.Apartment, error) {
	return r.ApartmentRepo.GetByID(ctx, id)
}

// SearchApartments is the resolver for the searchApartments field.
func (r *queryResolver) SearchApartments(ctx context.Context, input model.ApartmentSearchInput) ([]*entities.Apartment, error) {
	criteria := &entities.ApartmentSearchCriteria{}

	if input.Query != nil {
		criteria.Number = input.Query
	}
	if input.Bedrooms != nil {
		criteria.Bedrooms = input.Bedrooms
	}
	if input.Suites != nil {
		criteria.Suites = input.Suites
	}
	if input.TowerID != nil {
		criteria.TowerID = input.TowerID
	}
	if input.PriceMin != nil {
		criteria.PriceMin = input.PriceMin
	}
	if input.PriceMax != nil {
		criteria.PriceMax = input.PriceMax
	}

	return r.ApartmentRepo.Search(ctx, criteria)
}

// GalleryImages is the resolver for the galleryImages field.
func (r *queryResolver) GalleryImages(ctx context.Context, route *string) ([]*entities.GalleryImage, error) {
	if route != nil {
		return r.GalleryRepo.GetByRoute(ctx, *route)
	}
	return []*entities.GalleryImage{}, nil
}

// GalleryImage is the resolver for the galleryImage field.
func (r *queryResolver) GalleryImage(ctx context.Context, id string) (*entities.GalleryImage, error) {
	return r.GalleryRepo.GetByID(ctx, id)
}

// GalleryRoutes is the resolver for the galleryRoutes field.
func (r *queryResolver) GalleryRoutes(ctx context.Context) ([]string, error) {
	return []string{"home", "gallery", "apartments"}, nil
}

// ImagePins is the resolver for the imagePins field.
func (r *queryResolver) ImagePins(ctx context.Context, galleryImageID string) ([]*entities.ImagePin, error) {
	return []*entities.ImagePin{}, nil
}

// ImagePin is the resolver for the imagePin field.
func (r *queryResolver) ImagePin(ctx context.Context, id string) (*entities.ImagePin, error) {
	return &entities.ImagePin{ID: id}, nil
}

// AppConfig is the resolver for the appConfig field.
func (r *queryResolver) AppConfig(ctx context.Context) (*entities.AppConfig, error) {
	return &entities.AppConfig{}, nil
}

// GenerateSignedUploadURL is the resolver for the generateSignedUploadUrl field.
func (r *queryResolver) GenerateSignedUploadURL(ctx context.Context, fileName string, contentType string, folder string) (*entities.SignedUploadURL, error) {
	return r.StorageService.GenerateSignedUploadURL(ctx, fileName, contentType, folder)
}

// GenerateBulkDownload is the resolver for the generateBulkDownload field.
func (r *queryResolver) GenerateBulkDownload(ctx context.Context, towerID *string) (*entities.BulkDownload, error) {
	if towerID == nil {
		return nil, fmt.Errorf("tower ID is required")
	}

	result, err := r.BulkDownloadService.GenerateTowerDownload(ctx, *towerID)
	if err != nil {
		return nil, err
	}

	return &entities.BulkDownload{
		DownloadURL: result.DownloadURL,
		FileName:    result.FileName,
		FileSize:    result.FileSize,
		ExpiresIn:   result.ExpiresIn,
		CreatedAt:   result.CreatedAt,
	}, nil
}

// Fields is the resolver for the fields field.
func (r *signedUploadUrlResolver) Fields(ctx context.Context, obj *entities.SignedUploadURL) (any, error) {
	return obj.Fields, nil
}

// Mutation returns generated.MutationResolver implementation.
func (r *Resolver) Mutation() generated.MutationResolver { return &mutationResolver{r} }

// Query returns generated.QueryResolver implementation.
func (r *Resolver) Query() generated.QueryResolver { return &queryResolver{r} }

// SignedUploadUrl returns SignedUploadUrlResolver implementation.
func (r *Resolver) SignedUploadUrl() *signedUploadUrlResolver {
	return &signedUploadUrlResolver{r}
}

type mutationResolver struct{ *Resolver }
type queryResolver struct{ *Resolver }
type signedUploadUrlResolver struct{ *Resolver }
